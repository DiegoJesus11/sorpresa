<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Nuestra Historia en Rosas ğŸŒ¹</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Lora:ital,wght@0,400;0,600;1,400&display=swap"
        rel="stylesheet">
    <style>
        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        *,
        *::before,
        *::after {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Lora', Georgia, serif;
            background: #0a0000;
            color: #f5e6e0;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FALLING PETALS (background)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .petals-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            overflow: hidden;
        }

        .petal {
            position: absolute;
            top: -60px;
            width: 18px;
            height: 22px;
            border-radius: 50% 0 50% 50%;
            opacity: 0.5;
            animation: fall linear infinite;
        }

        .petal.red {
            background: radial-gradient(circle at 30% 30%, #e63946, #9d0208);
        }

        .petal.yellow {
            background: radial-gradient(circle at 30% 30%, #ffd166, #e09f3e);
        }

        .petal.dark-red {
            background: radial-gradient(circle at 30% 30%, #a4161a, #6a040f);
        }

        @keyframes fall {
            0% {
                transform: translateY(0) rotate(0deg) translateX(0);
                opacity: 0;
            }

            10% {
                opacity: 0.6;
            }

            90% {
                opacity: 0.4;
            }

            100% {
                transform: translateY(110vh) rotate(720deg) translateX(80px);
                opacity: 0;
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INTRO SCREEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #intro {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(ellipse at center, #1a0005 0%, #0a0000 70%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: opacity 1.2s ease, visibility 1.2s ease;
        }

        #intro.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        #intro h1 {
            font-family: 'Playfair Display', serif;
            font-size: clamp(2rem, 7vw, 4rem);
            color: #ffd166;
            text-align: center;
            margin-bottom: 10px;
            animation: fadeInUp 1.5s ease forwards;
            opacity: 0;
        }

        #intro .subtitle {
            font-family: 'Lora', serif;
            font-style: italic;
            font-size: clamp(1rem, 4vw, 1.5rem);
            color: #e6948a;
            margin-bottom: 50px;
            animation: fadeInUp 1.5s ease 0.4s forwards;
            opacity: 0;
            text-align: center;
            padding: 0 20px;
        }

        #startBtn {
            font-family: 'Playfair Display', serif;
            font-size: 1.2rem;
            padding: 16px 50px;
            border: 2px solid #e63946;
            background: transparent;
            color: #ffd166;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.4s ease;
            animation: fadeInUp 1.5s ease 0.8s forwards;
            opacity: 0;
            letter-spacing: 2px;
        }

        #startBtn:hover {
            background: #e63946;
            color: #fff;
            box-shadow: 0 0 30px rgba(230, 57, 70, 0.5);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVIGATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #roseTrail {
            position: fixed;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 300;
            display: none;
            flex-direction: column;
            gap: 6px;
            align-items: center;
        }

        .trail-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid #e63946;
            background: transparent;
            transition: all 0.4s ease;
            cursor: pointer;
            opacity: 0.6;
        }

        .trail-dot.active {
            background: #e63946;
            opacity: 1;
            transform: scale(1.3);
        }

        .trail-dot.yellow {
            border-color: #ffd166;
        }

        .trail-dot.yellow.active {
            background: #ffd166;
        }

        #progressBar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, #e63946, #ffd166);
            z-index: 400;
            transition: width 0.3s ease;
        }

        #musicBtn {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 500;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            border: 2px solid #e63946;
            background: rgba(10, 0, 0, 0.8);
            color: #ffd166;
            font-size: 1.2rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        #musicBtn.playing {
            animation: pulse 1.5s infinite;
            background: #e63946;
            color: white;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTENT BLOCKS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        .block-title {
            font-family: 'Playfair Display', serif;
            font-size: 2rem;
            color: #e6948a;
            text-align: center;
            margin: 80px 0 40px;
            opacity: 0.8;
            letter-spacing: 2px;
            display: none;
            /* Hidden by default, script can maybe show */
        }

        .chapter {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px 20px;
            position: relative;
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 1s, transform 1s;
        }

        .chapter.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .rose-icon {
            width: 80px;
            height: 80px;
            cursor: pointer;
            transition: transform 0.6s ease;
            margin-bottom: 20px;
            filter: drop-shadow(0 0 10px rgba(230, 57, 70, 0.3));
        }

        .rose-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .rose-icon.yellow {
            filter: drop-shadow(0 0 10px rgba(255, 209, 102, 0.3));
        }

        .content-box {
            max-width: 600px;
            width: 100%;
            text-align: center;
            background: rgba(26, 0, 5, 0.6);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid rgba(230, 57, 70, 0.2);
            backdrop-filter: blur(5px);
            transform: scale(0.95);
            transition: all 0.8s ease;
            display: none;
            /* Initially hidden until rose clicked */
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        .content-box.revealed {
            display: block;
            transform: scale(1);
            animation: fadeInBox 0.8s ease forwards;
        }

        @keyframes fadeInBox {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .media-container {
            width: 100%;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
        }

        .media-img,
        .media-video {
            width: 100%;
            display: block;
            object-fit: contain;
            max-height: 500px;
            background: rgba(0, 0, 0, 0.2);
        }

        #box-0 .media-img {
            max-height: 400px;
        }

        .text-content {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #f5e6e0;
            font-style: italic;
        }

        .chapter-number {
            font-family: 'Playfair Display', serif;
            color: #ffd166;
            font-size: 0.9rem;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0.7;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FINAL SECTION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        #finalMessage {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 50px 20px;
        }

        #finalMessage h2 {
            font-family: 'Playfair Display', serif;
            font-size: 2.5rem;
            color: #ffd166;
            margin-bottom: 20px;
        }

        .final-text-area {
            max-width: 700px;
            font-size: 1.3rem;
            line-height: 1.6;
            color: #e6948a;
            margin-bottom: 40px;
        }

        .final-rose-garden {
            position: relative;
            width: 100%;
            height: 200px;
            margin-top: 30px;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ANIMATIONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVENESS (Mobile Tweaks)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        @media (max-width: 480px) {
            .content-box {
                padding: 15px;
            }

            .text-content {
                font-size: 1rem;
            }

            #roseTrail {
                right: 8px;
            }

            .trail-dot {
                width: 8px;
                height: 8px;
            }

            #finalMessage h2 {
                font-size: clamp(1.8rem, 8vw, 2.5rem);
            }

            .final-text-area {
                font-size: 1.1rem;
            }
        }
    </style>
</head>

<body>

    <!-- PETALS -->
    <div class="petals-container" id="petalsContainer"></div>

    <!-- PROGRESS -->
    <div id="progressBar"></div>
    <div id="roseTrail"></div>

    <!-- MUSIC -->
    <button id="musicBtn" onclick="toggleMusic()">ğŸµ</button>
    <audio id="musicPlayer" src="musica.mp3" loop preload="auto"></audio>

    <!-- INTRO -->
    <div id="intro">
        <h1>Nuestra Historia</h1>
        <p class="subtitle">"AndÃ¡bamos sin buscarnos pero sabiendo que andÃ¡bamos para encontrarnos"</p>
        <button id="startBtn" onclick="startExperience()">Abrir el Libro ğŸŒ¹</button>
    </div>

    <!-- CHAPTERS CONTAINER -->
    <div id="storyContainer" style="display:none;">
        <!-- Items will be injected by JS for cleanliness -->
    </div>

    <!-- FINAL MESSAGE -->
    <div id="finalMessage" style="display:none;">
        <h2>Gracias por ser mi niÃ±a engreÃ­da</h2>
        <div class="final-text-area">
            <p>Siempre estarÃ© orgulloso de nuestra historia.</p>
            <p style="margin-top:20px; font-size: 1rem; color: #fff;">Con todo mi amor, Diego. ğŸ’›</p>
        </div>
        <div class="final-rose-garden" id="garden"></div>
    </div>


    <script>
        // DATA from guion.md
        const story = [
            // Bloque 1
            {
                title: "Siempre encantadora",
                text: "Hay cosas que el tiempo no cambia. Esa chispa y esa forma de pararte frente al mundo ya las llevabas contigo mucho antes de que yo apareciera. Siempre fuiste una niÃ±a encantadora.",
                media: "c1.jpg",
                type: "rose-red"
            },
            {
                title: "Tu mundo",
                text: "Y asÃ­, esa niÃ±a creciÃ³ para convertirse en la mujer que hoy llena mis dÃ­as. Compartir espacios con tu familia y amigos fue entender que tu mundo es un lugar donde siempre quise quedarme.",
                media: "c2.jpg",
                type: "rose-yellow"
            },
            // Bloque 2
            {
                title: "El comienzo",
                text: "Todo empezÃ³ en el 2022. En esos pasillos de la universidad donde al principio Ã©ramos extraÃ±os y luego, casi sin darnos cuenta, nos convertimos en esto que guardo con tanto cariÃ±o. AquÃ­ todavÃ­a no sabÃ­amos todo lo que vendrÃ­a.",
                media: "c3.jpg",
                type: "rose-red"
            },
            {
                title: "Tardes de estudio",
                text: "Nuestras tardes de estudio... o bueno, tus fotos en la MacBook solo porque te encantaba la resoluciÃ³n mientras yo intentaba concentrarme. Esos momentos cotidianos en la facultad son de mis tesoros mÃ¡s grandes.",
                media: "c4.jpg",
                type: "rose-yellow"
            },
            {
                title: "AlegrÃ­a compartida",
                text: "Tu alegrÃ­a por un buen examen y tus ganas constantes de molestarme mientras intentaba leer. Gracias por enseÃ±arme que estudiar no tiene por quÃ© ser aburrido si es a tu lado.",
                media: "c5.jpg",
                type: "rose-red"
            },
            // Bloque 3
            {
                title: "Mi niÃ±a engreÃ­da",
                text: "Mi niÃ±a engreÃ­da... esa carita de 'renegona' que pones es, irÃ³nicamente, de las cosas que mÃ¡s amo de ti. Me encanta que no ocultes quiÃ©n eres, ni siquiera cuando estÃ¡s juzgando el mundo con la mirada.",
                media: "c6.jpg",
                type: "rose-yellow"
            },
            {
                title: "Desacuerdos que unen",
                text: "Como aquel dÃ­a en el LUM. Te molestaste porque no lograba la foto perfecta, pero terminamos sorprendidos por la pelÃ­cula y olvidando el enojo. Porque contigo, hasta los desacuerdos terminan en una buena historia.",
                media: "c7.jpg",
                type: "rose-red"
            },
            {
                title: "ConexiÃ³n constante",
                text: "Esas fotos random que me mandabas para 'reportarte'. Detalles simples que me hacÃ­an sentir que, sin importar dÃ³nde estuviÃ©ramos, estÃ¡bamos conectados.",
                media: "c8.jpg",
                type: "rose-yellow"
            },
            // Bloque 4
            {
                title: "Cuidarte es amarte",
                text: "Si tuviera que elegir un momento que defina mi amor por ti, serÃ­a este. Halloween. No por el grupo o la fiesta, sino por el final de la noche, caminando con tus tacos en mis manos y medias, pero tÃº con mis zapatos porque no aguantabas el dolor. Mi mayor forma de amarte siempre serÃ¡ cuidarte.",
                media: "c9.jpg",
                type: "rose-red"
            },
            {
                title: "Cita de pelÃ­cula",
                text: "Cualquier salida, incluso a un centro comercial, se siente como una cita de pelÃ­cula si estÃ¡s tÃº sonriendo asÃ­.",
                media: "c10.jpg",
                type: "rose-yellow"
            },
            // Bloque 5
            {
                title: "Nuestras comidas",
                text: "Nuestras comidas... ese caldo que tanto te gusta y que te deja con una sonrisa de satisfacciÃ³n que me llena el alma.",
                media: "c11.jpg",
                type: "rose-red"
            },
            {
                title: "Mi recuerdo favorito",
                text: "Este es mi recuerdo favorito. Verte dormir con tanta paz, incluso usando mis libros de almohada. Hay algo en tu tranquilidad que me da una paz que no encuentro en ningÃºn otro lugar.",
                media: "c12.jpg",
                type: "rose-yellow"
            },
            {
                title: "Tu compaÃ±Ã­a",
                text: "EsperÃ¡ndome siempre, aunque te ganara el sueÃ±o. Tu compaÃ±Ã­a es el regalo mÃ¡s valioso que he recibido.",
                media: "c13.jpg",
                type: "rose-red"
            },
            // Bloque 6
            {
                title: "Como niÃ±os",
                text: "Â¿Recuerdas este dÃ­a? DespuÃ©s de tomarnos fotos con el Ã¡rbol, nos fuimos a jugar con los carritos para competir con Camila y Emilia. Me encanta que podamos ser niÃ±os otra vez cuando estamos juntos, riendo por puras tonterÃ­as.",
                media: "c14.jpg",
                type: "rose-yellow"
            },
            {
                title: "Risas inolvidables",
                text: "Y bueno... nuestros intentos fallidos de ser influencers. Yo haciendo todo lo que podÃ­a para seguirte el ritmo. No nos saliÃ³ el trend, pero nos salieron las mejores risas.",
                media: "video.mp4",
                video: true,
                type: "rose-red"
            },
            // Bloque 7
            {
                title: "El sÃ­mbolo",
                text: "A veces las cosas salen perfectas, como este corazÃ³n frente al mar. Otras veces, como nosotros ahora, las cosas son mÃ¡s difÃ­ciles. Pero el sÃ­mbolo sigue ahÃ­.",
                media: "c16.jpg",
                type: "rose-yellow"
            },
            {
                title: "Siempre en mi corazÃ³n",
                text: "Atrapado en tus piernas, y honestamente, nunca fui mÃ¡s feliz que ahÃ­. SÃ© que he fallado y te pido perdÃ³n de todo corazÃ³n; sÃ© que todo entre nosotros se ha complicado mucho, pero te tengo siempre en mi corazÃ³n. Te regalo muchas rosas, de esas que yo puedo hacer en este momento con mi cÃ³digo. Ten un bonito dÃ­a.",
                media: "c17.jpg",
                type: "rose-red"
            }
        ];

        // SVG ROSES
        const redRoseSVG = '<svg viewBox="0 0 100 120"><path d="M50 118 Q48 90 50 70" stroke="#2d6a4f" stroke-width="3" fill="none"/><ellipse cx="42" cy="85" rx="12" ry="6" fill="#40916c" transform="rotate(-30 42 85)"/><ellipse cx="50" cy="38" rx="18" ry="25" fill="#e63946" opacity="0.9"/><ellipse cx="38" cy="42" rx="16" ry="22" fill="#c1121f" transform="rotate(-20 38 42)" opacity="0.85"/><ellipse cx="62" cy="42" rx="16" ry="22" fill="#c1121f" transform="rotate(20 62 42)" opacity="0.85"/><ellipse cx="50" cy="35" rx="10" ry="14" fill="#ff758f" opacity="0.7"/><ellipse cx="50" cy="30" rx="6" ry="9" fill="#ffb3c1" opacity="0.6"/></svg>';
        const yellowRoseSVG = '<svg viewBox="0 0 100 120"><path d="M50 118 Q48 90 50 70" stroke="#2d6a4f" stroke-width="3" fill="none"/><ellipse cx="42" cy="85" rx="12" ry="6" fill="#40916c" transform="rotate(-30 42 85)"/><ellipse cx="50" cy="38" rx="18" ry="25" fill="#ffd166" opacity="0.9"/><ellipse cx="38" cy="42" rx="16" ry="22" fill="#e09f3e" transform="rotate(-20 38 42)" opacity="0.85"/><ellipse cx="62" cy="42" rx="16" ry="22" fill="#e09f3e" transform="rotate(20 62 42)" opacity="0.85"/><ellipse cx="50" cy="35" rx="10" ry="14" fill="#ffe08a" opacity="0.7"/><ellipse cx="50" cy="30" rx="6" ry="9" fill="#fff3bf" opacity="0.6"/></svg>';

        function init() {
            const container = document.getElementById('storyContainer');
            const trail = document.getElementById('roseTrail');

            // Create Petals
            const pContainer = document.getElementById('petalsContainer');
            const items = ['red', 'yellow', 'dark-red'];
            for (let i = 0; i < 40; i++) {
                const el = document.createElement('div');
                el.className = 'petal ' + items[Math.floor(Math.random() * 3)];
                el.style.left = Math.random() * 100 + '%';
                el.style.animationDuration = (5 + Math.random() * 10) + 's';
                el.style.animationDelay = (Math.random() * 5) + 's';
                pContainer.appendChild(el);
            }

            // Render Stories
            story.forEach((item, index) => {
                // Chapter
                const section = document.createElement('div');
                section.className = 'chapter';
                section.id = 'chapter-' + index;

                // Rose Type
                const isYellow = item.type === 'rose-yellow';
                const svgIcon = isYellow ? yellowRoseSVG : redRoseSVG;

                let mediaHtml = '';
                if (item.video) {
                    mediaHtml = `<video class="media-video" src="${item.media}" controls playsinline></video>`;
                } else {
                    mediaHtml = `<img class="media-img" src="${item.media}" alt="${item.title}" loading="lazy">`;
                }

                section.innerHTML = `
      <div class="chapter-number">${index + 1} / ${story.length}</div>
      <div class="rose-icon ${isYellow ? 'yellow' : ''}" onclick="reveal(${index})">
        ${svgIcon}
      </div>
      <div class="content-box" id="box-${index}">
        <h2 style="color:${isYellow ? '#ffd166' : '#e63946'}; font-family:'Playfair Display'; margin-bottom:15px;">${item.title}</h2>
        <div class="media-container">${mediaHtml}</div>
        <p class="text-content">${item.text}</p>
      </div>
    `;
                container.appendChild(section);

                // Trail Dot
                const dot = document.createElement('div');
                dot.className = 'trail-dot ' + (isYellow ? 'yellow' : '');
                dot.onclick = () => { document.getElementById('chapter-' + index).scrollIntoView(); };
                trail.appendChild(dot);
            });

            // Add Final Message Section (after loop)
            // already in HTML

            // Intersection Observer for Animations and Audio Trigger
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');

                        // Music Trigger on Block 2 (index 2)
                        if (entry.target.id === 'chapter-2' && !musicStarted) {
                            playMusic();
                        }

                        // Active Trail
                        if (entry.target.classList.contains('chapter')) {
                            const idx = parseInt(entry.target.id.split('-')[1]);
                            updateTrail(idx);
                        }
                    }
                });
            }, { threshold: 0.4 });

            document.querySelectorAll('.chapter').forEach(el => observer.observe(el));
            observer.observe(document.getElementById('finalMessage'));

            // Final Garden Generation
            const garden = document.getElementById('garden');
            for (let k = 0; k < 50; k++) {
                const rose = document.createElement('div');
                rose.style.position = 'absolute';
                rose.style.left = Math.random() * 90 + '%';
                rose.style.bottom = Math.random() * 150 + 'px';
                rose.style.width = '40px';
                rose.style.height = '40px';
                rose.innerHTML = Math.random() > 0.5 ? redRoseSVG : yellowRoseSVG;
                garden.appendChild(rose);
            }
        }


        // MUSIC - Native HTML5 Audio (guaranteed to work from file://)
        var musicStarted = false;

        function playMusic() {
            var audio = document.getElementById('musicPlayer');
            audio.volume = 1.0;
            audio.play();
            musicStarted = true;
            document.getElementById('musicBtn').classList.add('playing');
        }

        function toggleMusic() {
            var audio = document.getElementById('musicPlayer');
            var btn = document.getElementById('musicBtn');
            if (!audio.paused) {
                audio.pause();
                btn.classList.remove('playing');
            } else {
                audio.play();
                btn.classList.add('playing');
            }
        }

        function startExperience() {
            document.getElementById('intro').classList.add('hidden');
            document.getElementById('storyContainer').style.display = 'block';
            document.getElementById('roseTrail').style.display = 'flex';
            document.getElementById('finalMessage').style.display = 'flex';

            // Play music on user click - guaranteed to work
            playMusic();

            setTimeout(function () {
                window.scrollTo(0, 0);
            }, 100);
        }

        function reveal(index) {
            const box = document.getElementById('box-' + index);
            const icon = document.querySelector(`#chapter-${index} .rose-icon`);
            icon.style.opacity = '0';
            icon.style.pointerEvents = 'none';
            icon.style.display = 'none';
            box.classList.add('revealed');
        }

        function updateTrail(idx) {
            document.querySelectorAll('.trail-dot').forEach((d, i) => {
                d.classList.toggle('active', i === idx);
            });
            const pct = ((idx + 1) / story.length) * 100;
            document.getElementById('progressBar').style.width = pct + '%';
        }

        window.onload = init;

    </script>
</body>

</html>